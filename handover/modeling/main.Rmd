---
title: "Untitled"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(dbplyr)
library(lubridate)
library(tibble)
library(ggplot2)
library(stringr)
library(gridExtra)
library(network)
library(ggraph)
library(visNetwork)
library(networkD3)
library(igraph)
library(tidygraph)
library(cluster)
library(fpc)
library(plotly)
library(cluster)
library(factoextra)
library(anomalize)
library(boot)
library(leaps)
library(stargazer)
```

```{r}
pathname <- '/home/alex/S2DS/FSA/handover/data/'
filename <- 'all_data__090300_201401-201602_total_dump_05.RData'
dump_files <- FALSE
route <- paste(pathname,filename,sep='')
load(route)

node_data <- data$node_data#old "all_info"
edge_data <- data$edge_data#old "si"
```

```{r}
source("/home/alex/S2DS/FSA/handover/modeling/build_network.R")
source("/home/alex/S2DS/FSA/handover/modeling/model_linear.R")
source("/home/alex/S2DS/FSA/handover/modeling/model_linear_reduced.R")
source("/home/alex/S2DS/FSA/handover/modeling/dump_lm_sum.R")
```

```{r}
p1 <- ggplot(data = node_data) + geom_point(mapping = aes(
      y=overall_flux_n,
      x=max_influx_n,color=ratio),
      size=0.75) +
      scale_colour_gradientn(colours=rainbow(4)) + xlim(0,40) + ylim(0,40) +
      ggtitle('Mate: normalized trade fluxes') + ylab('Overall') + xlab('Maximum influx')
p2 <- ggplot(data = node_data) + geom_point(mapping = aes(
      y=overall_flux_n,
      x=max_outflux_n,color=ratio),
      size=0.75) +
      scale_colour_gradientn(colours=rainbow(4)) + xlim(0,40) + ylim(0,40) +
      ggtitle('Mate: normalized trade fluxes') + ylab('Overall') + xlab('Maximum outflux')
p3 <- ggplot(data = node_data) + geom_point(mapping = aes(
      y=overall_flux_n,
      x=ave_influx_n,color=ratio),
      size=0.75) +
      scale_colour_gradientn(colours=rainbow(4)) + xlim(0,40) + ylim(0,40) +
      ggtitle('Mate: normalized trade fluxes') + ylab('Overall') + xlab('Average influx')
p4 <- ggplot(data = node_data) + geom_point(mapping = aes(
      y=overall_flux_n,
      x=ave_outflux_n,color=ratio),
      size=0.75) +
      scale_colour_gradientn(colours=rainbow(4)) + xlim(0,40) + ylim(0,40) +
      ggtitle('Mate: normalized trade fluxes') + ylab('Overall') + xlab('Average outflux')
grid.arrange(p1,p2,p3,p4,nrow=2)
```


```{r}
lm.results <- model_linear(node_data)
```

#```{r}
#lm.results2 <- model_linear_reduced(node_data)
#```


#```{r}
#build_network(edge_data,1,90)
#```

```{r}
if(dump_files){
pp <- '/home/alex/Dropbox/pivigo/report/data/'
stargazer(  lm.results[[1]], omit.stat=c("LL","ser","f"), ci=FALSE, single.row=TRUE,        out=paste(pp,'lm_sum_05_pow1.tex',sep=''))
stargazer(t(lm.results[[2]]$outmat), omit.stat=c("LL","ser","f"), ci=FALSE, single.row=TRUE,out=paste(pp,'lm_reg_05_pow1.tex',sep=''))
stargazer(  lm.results[[3]], omit.stat=c("LL","ser","f"), ci=FALSE, single.row=TRUE,        out=paste(pp,'lm_sum_05_pow2.tex',sep=''))
stargazer(t(lm.results[[4]]$outmat), omit.stat=c("LL","ser","f"), ci=FALSE, single.row=TRUE,out=paste(pp,'lm_reg_05_pow2.tex',sep=''))
stargazer(  lm.results[[5]], omit.stat=c("LL","ser","f"), ci=FALSE, single.row=TRUE,        out=paste(pp,'lm_sum_05_pow3.tex',sep=''))
stargazer(t(lm.results[[6]]$outmat), omit.stat=c("LL","ser","f"), ci=FALSE, single.row=TRUE,out=paste(pp,'lm_reg_05_pow3.tex',sep=''))
}
```
